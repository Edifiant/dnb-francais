<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objectif Brevet - Restauration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bleu: #2563eb; --violet: #7c3aed; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-top: 70px; }
        .top-bar { position: fixed; top: 0; left: 0; right: 0; background: white; padding: 10px; border-bottom: 2px solid var(--bleu); z-index: 1000; display: flex; justify-content: space-between; font-weight: bold; }
        .nav-menu { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 10px; }
        .nav-btn { white-space: nowrap; padding: 8px 15px; border-radius: 20px; border: 2px solid var(--bleu); background: white; color: var(--bleu); font-weight: bold; cursor: pointer; }
        .nav-btn.active { background: var(--bleu); color: white; }
        .card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #ddd; border-top: 5px solid var(--violet); margin-bottom: 15px; }
        .phrase { font-size: 1.1rem; line-height: 1.6; margin-bottom: 15px; }
        .word-btn { padding: 10px; border: 2px solid var(--bleu); border-radius: 8px; background: #f0f7ff; font-weight: bold; margin: 5px; cursor: pointer; width: 100%; text-align: left; }
        .flashcard { background: white; border: 2px solid var(--bleu); padding: 30px; border-radius: 15px; text-align: center; font-weight: bold; min-height: 100px; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 15px; }
        .expli { display: none; background: #f1f5f9; padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 4px solid var(--bleu); }
    </style>
</head>
<body>

<div class="top-bar">
    <div id="scoreDisplay">Score : 0 / 0</div>
    <div>ðŸŽ“ Brevet 2026</div>
</div>

<div class="nav-menu" id="menu"></div>
<div id="app">Chargement des donnÃ©es...</div>

<script>
    let score = 0, total = 0;
    // VERIFIE BIEN CETTE URL :
    const urlBase = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRoAJJNx2wqbdV3bqbJDt0cmf8DPCCk39wiQa4fdpkHj8fFcKBf0T4viApM-A3lSWbXHeJ8uasSh-M0/pub?output=csv&gid=";

    const sections = [
        { name: "Grammaire", gid: "1679242234" },
        { name: "Conjugaison", gid: "1987121612" },
        { name: "Orthographe", gid: "1665486895" },
        { name: "Vocabulaire", gid: "1862590497" },
        { name: "Figures de style", gid: "1943336125" }
    ];

    function init() {
        const menu = document.getElementById('menu');
        sections.forEach(s => {
            const b = document.createElement('button');
            b.className = 'nav-btn'; b.innerText = s.name;
            b.onclick = () => loadData(s.gid, b);
            menu.appendChild(b);
        });
        loadData(sections[0].gid, menu.firstChild);
    }

    function loadData(gid, btn) {
        score = 0; total = 0;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('app').innerHTML = "Chargement en cours...";
        
        Papa.parse(urlBase + gid, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: (results) => display(results.data)
        });
    }

    function display(data) {
        let html = "";
        data.forEach((row, i) => {
            // SÃ©curitÃ© pour Ã©viter le "undefined" si la ligne est vide
            if (!row.Type && !row.Question && !row.Titre) return;

            const type = (row.Type || "").toUpperCase();

            // CAS FLASHCARD
            if (type === "FLASHCARD") {
                html += `<div class="flashcard" onclick="this.innerText = this.innerText === '${row.Question}' ? '${row.RÃ©ponse_A}' : '${row.Question}'">${row.Question}</div>`;
            }
            // CAS EXERCICE (Trou ou QCM)
            else if (row.Bonne_RÃ©ponse) {
                total++;
                const q = row.Question || row.Texte_A_Trou || "Question sans titre";
                html += `<div class="card">
                    <div class="phrase">${q.replace('[...]', '______')}</div>
                    <div id="opts-${i}">
                        <button class="word-btn" onclick="check('${row.RÃ©ponse_A}', '${row.Bonne_RÃ©ponse}', ${i}, this)">${row.RÃ©ponse_A}</button>
                        <button class="word-btn" onclick="check('${row.RÃ©ponse_B}', '${row.Bonne_RÃ©ponse}', ${i}, this)">${row.RÃ©ponse_B}</button>
                        ${row.RÃ©ponse_C ? `<button class="word-btn" onclick="check('${row.RÃ©ponse_C}', '${row.Bonne_RÃ©ponse}', ${i}, this)">${row.RÃ©ponse_C}</button>` : ''}
                    </div>
                    <div id="ex-${i}" class="expli">ðŸ’¡ ${row.Explication || "Bien jouÃ© !"}</div>
                </div>`;
            }
            // CAS COURS
            else if (row.Titre) {
                html += `<div class="card"><h3>${row.Titre}</h3><p style="white-space:pre-wrap;">${row.Contenu}</p></div>`;
            }
        });
        document.getElementById('app').innerHTML = html || "Aucune donnÃ©e trouvÃ©e dans cette section.";
        updateScore();
    }

    function check(val, correct, id, btn) {
        const parent = document.getElementById('opts-' + id);
        if (parent.style.pointerEvents === "none") return;
        
        parent.style.pointerEvents = "none";
        if (val.trim() === correct.trim()) {
            score++;
            btn.style.background = "#dcfce7";
            confetti();
        } else {
            btn.style.background = "#fee2e2";
        }
        document.getElementById('ex-' + id).style.display = "block";
        updateScore();
    }

    function updateScore() {
        document.getElementById('scoreDisplay').innerText = `Score : ${score} / ${total}`;
    }

    init();
</script>
</body>
</html>
